{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "Financial Information with Deposit Schema",
  "description": "Schema for Step 132 - Financial information entry. Deposits are created with required_amount only. ALL deposit payments must be made through interim payments.",
  "required": ["lease_type", "financial_information"],
  "properties": {
    "lease_type": {
      "type": "string",
      "description": "Type of lease (must match existing lease type)",
      "enum": ["DOV", "LONG_TERM", "SHIFT", "SHORT_TERM", "MEDALLION"]
    },
    "lease_id": {
      "type": "string",
      "description": "Optional lease identifier override"
    },
    "financial_information": {
      "type": "object",
      "description": "Financial breakdown based on lease type",
      "anyOf": [
        {
          "title": "DOV Lease Financial Info",
          "required": ["lease_amount", "med_lease", "veh_lease"],
          "properties": {
            "tlc_vehicle_lifetime_cap": {"type": "number", "minimum": 0},
            "amount_collected": {"type": "number", "minimum": 0},
            "lease_amount": {"type": "number", "minimum": 0},
            "med_lease": {"type": "number", "minimum": 0},
            "med_tlc_maximum_amount": {"type": "number", "minimum": 0},
            "veh_lease": {"type": "number", "minimum": 0},
            "veh_sales_tax": {"type": "number", "minimum": 0},
            "tlc_inspection_fees": {"type": "number", "minimum": 0},
            "tax_stamps": {"type": "number", "minimum": 0},
            "registration": {"type": "number", "minimum": 0},
            "veh_tlc_maximum_amount": {"type": "number", "minimum": 0},
            "total_vehicle_lease": {"type": "number", "minimum": 0},
            "total_medallion_lease_payment": {"type": "number", "minimum": 0},
            "security_deposit": {
              "type": "number", 
              "minimum": 0, 
              "description": "DEPRECATED: Legacy field for backward compatibility. Use deposit_info for new deposit system."
            },
            "additional_balance_due": {"type": "number", "minimum": 0},
            "cancellation_charge": {"type": "number", "minimum": 0}
          }
        },
        {
          "title": "Long-Term/Shift Lease Financial Info",
          "required": ["lease_amount"],
          "properties": {
            "management_recommendation": {"type": "number", "minimum": 0},
            "day_shift": {"type": "number", "minimum": 0},
            "day_tlc_maximum_amount": {"type": "number", "minimum": 0},
            "night_shift": {"type": "number", "minimum": 0},
            "night_tlc_maximum_amount": {"type": "number", "minimum": 0},
            "lease_amount": {"type": "number", "minimum": 0},
            "security_deposit": {
              "type": "number", 
              "minimum": 0, 
              "description": "DEPRECATED: Legacy field for backward compatibility"
            },
            "additional_balance_due": {"type": "number", "minimum": 0},
            "cancellation_charge": {"type": "number", "minimum": 0}
          }
        },
        {
          "title": "Short-Term Lease Financial Info",
          "properties": {
            "1_week_or_longer": {
              "type": "object",
              "properties": {
                "day_shift": {"type": "number", "minimum": 0},
                "night_shift": {"type": "number", "minimum": 0}
              }
            },
            "1_week_or_longer_tlc_maximum_amount": {
              "type": "object",
              "properties": {
                "day_shift": {"type": "number", "minimum": 0},
                "night_shift": {"type": "number", "minimum": 0}
              }
            },
            "day_of_week": {
              "type": "string",
              "enum": ["sun", "mon", "tus", "wen", "thu", "fri", "sat"]
            },
            "sun": {
              "type": "object",
              "properties": {
                "day_shift": {"type": "number", "minimum": 0},
                "night_shift": {"type": "number", "minimum": 0}
              }
            },
            "sun_tlc_maximum_amount": {
              "type": "object",
              "properties": {
                "day_shift": {"type": "number", "minimum": 0},
                "night_shift": {"type": "number", "minimum": 0}
              }
            },
            "mon": {"type": "object", "properties": {"day_shift": {"type": "number"}, "night_shift": {"type": "number"}}},
            "mon_tlc_maximum_amount": {"type": "object", "properties": {"day_shift": {"type": "number"}, "night_shift": {"type": "number"}}},
            "tus": {"type": "object", "properties": {"day_shift": {"type": "number"}, "night_shift": {"type": "number"}}},
            "tus_tlc_maximum_amount": {"type": "object", "properties": {"day_shift": {"type": "number"}, "night_shift": {"type": "number"}}},
            "wen": {"type": "object", "properties": {"day_shift": {"type": "number"}, "night_shift": {"type": "number"}}},
            "wen_tlc_maximum_amount": {"type": "object", "properties": {"day_shift": {"type": "number"}, "night_shift": {"type": "number"}}},
            "thu": {"type": "object", "properties": {"day_shift": {"type": "number"}, "night_shift": {"type": "number"}}},
            "thu_tlc_maximum_amount": {"type": "object", "properties": {"day_shift": {"type": "number"}, "night_shift": {"type": "number"}}},
            "fri": {"type": "object", "properties": {"day_shift": {"type": "number"}, "night_shift": {"type": "number"}}},
            "fri_tlc_maximum_amount": {"type": "object", "properties": {"day_shift": {"type": "number"}, "night_shift": {"type": "number"}}},
            "sat": {"type": "object", "properties": {"day_shift": {"type": "number"}, "night_shift": {"type": "number"}}},
            "sat_tlc_maximum_amount": {"type": "object", "properties": {"day_shift": {"type": "number"}, "night_shift": {"type": "number"}}},
            "security_deposit": {
              "type": "number", 
              "minimum": 0,
              "description": "DEPRECATED: Legacy field"
            },
            "additional_balance_due": {"type": "number", "minimum": 0},
            "cancellation_charge": {"type": "number", "minimum": 0}
          }
        },
        {
          "title": "Medallion-Only Lease Financial Info",
          "required": ["weekly_lease_rate"],
          "properties": {
            "weekly_lease_rate": {"type": "number", "minimum": 0},
            "week_tlc_maximum_amount": {"type": "number", "minimum": 0},
            "security_deposit": {
              "type": "number", 
              "minimum": 0,
              "description": "DEPRECATED: Legacy field"
            },
            "additional_balance_due": {"type": "number", "minimum": 0},
            "cancellation_charge": {"type": "number", "minimum": 0}
          }
        }
      ]
    },
    "deposit_info": {
      "type": "object",
      "description": "Security deposit requirement (NEW SYSTEM). IMPORTANT: Only required_amount is captured here. NO collection at lease creation. ALL deposit payments MUST be made through interim payments.",
      "required": ["required_amount"],
      "properties": {
        "required_amount": {
          "type": "number",
          "description": "Required deposit amount (typically 1 week lease fee). Set to 0 to waive deposit requirement.",
          "minimum": 0,
          "examples": [2500.00, 3000.00, 0.00]
        },
        "notes": {
          "type": "string",
          "description": "Optional notes about the deposit requirement (e.g., reason for waiver, special terms, payment plan)",
          "maxLength": 1000,
          "examples": [
            "Standard deposit requirement - payment via interim payments",
            "Deposit waived for long-term trusted driver per management approval",
            "Increased deposit due to driver payment history"
          ]
        }
      },
      "additionalProperties": false
    }
  },
  "examples": [
    {
      "lease_type": "DOV",
      "financial_information": {
        "lease_amount": 10000.00,
        "med_lease": 6000.00,
        "veh_lease": 4000.00,
        "total_vehicle_lease": 4500.00,
        "total_medallion_lease_payment": 6500.00,
        "security_deposit": 0.00,
        "additional_balance_due": 0.00,
        "cancellation_charge": 500.00
      },
      "deposit_info": {
        "required_amount": 2500.00,
        "notes": "Standard deposit - payment via interim payments"
      }
    },
    {
      "lease_type": "LONG_TERM",
      "financial_information": {
        "lease_amount": 8000.00,
        "management_recommendation": 2000.00,
        "day_shift": 4000.00,
        "night_shift": 4000.00,
        "security_deposit": 0.00,
        "additional_balance_due": 0.00,
        "cancellation_charge": 300.00
      },
      "deposit_info": {
        "required_amount": 0.00,
        "notes": "Deposit waived for trusted driver - approved by John Doe on 2025-01-15"
      }
    },
    {
      "lease_type": "DOV",
      "financial_information": {
        "lease_amount": 12000.00,
        "med_lease": 7000.00,
        "veh_lease": 5000.00,
        "total_vehicle_lease": 5500.00,
        "total_medallion_lease_payment": 7500.00,
        "additional_balance_due": 200.00,
        "cancellation_charge": 600.00
      },
      "deposit_info": {
        "required_amount": 3000.00,
        "notes": "Increased deposit - driver has 2 previous damage claims"
      }
    }
  ]
}